<html>
    <head>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />
        <link rel="stylesheet" href="css/style.css">
    </head>
    <body style='border:0; margin: 0'>
        <div id='map'></div>
        <div class="searchBar">
            <form id="form">
                <input type="text" name="end" class="SearchInput" id="destination" placeholder="Choose ending point" />
                <button class="searchButton" type="submit"></button>
            </form>
        </div>
		<div class="results" id="ResultTableContainer">
            <div class="ResultsTable">
                <table id="nearBikeResultTable" class="StyleTable" cellspacing="0" cellpadding="0">
				</table>
            </div>
		</div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
        <script src="https://www.mapquestapi.com/sdk/leaflet/v2.2/mq-map.js?key=S8d7L47mdyAG5nHG09dUnSPJjreUVPeC"></script>
        <script src="https://www.mapquestapi.com/sdk/leaflet/v2.2/mq-routing.js?key=S8d7L47mdyAG5nHG09dUnSPJjreUVPeC"></script>
        <script   src="./index.cjs"></script>
        <script src="./bundle.js"></script>
        <script src="https://cdn.socket.io/4.5.3/socket.io.min.js" integrity="sha384-WPFUvHkB1aHA5TDSZi6xtDgkF0wXJcIIxXhC6h8OT8EH3fC5PWro5pWJ1THjcfEi" crossorigin="anonymous"></script>

        <script>

           
           const socket = io("http://10.21.11.214:4000", {
                withCredentials: true
                });

                
                // creating table for results
                var ResultTable= document.getElementById("nearBikeResultTable");

                // listener
                socket.on('sendBikesResult', (msg) => {
                    var enc = new TextDecoder("utf-8");

                    var ResultTableContainer= document.getElementById("ResultTableContainer");
                    ResultTableContainer.style.visibility='visible';

                    //create bike container block for each bike
                    for (var i=0;i<msg.length;i++){

                        // creating a table entry
                        var row = ResultTable.insertRow(i);
                        var cell = row.insertCell(0);
                        //cell.style.height ='1%';

                        // creating image
                        var image= new Image();
                        image.src = 'data:image/png;base64,'+enc.decode(msg[i]['img_src']);
                        image.style.height="100%";
                        image.style.width="30%";

                        // Create bike container
                        var divContainer= document.createElement("div");
                        divContainer.classList.add("grid-container");

                        // create elements
                        var divModel=document.createElement("div");
                        var divPosition=document.createElement("div");
                        var divName=document.createElement("div");
                        var divButton=document.createElement("div");
                        var divPicture=document.createElement("div");

                        //appendText from imcoming message
                        var name = document.createElement('label');
                        name.innerHTML =  msg[i]['name'];
                        divName.appendChild(name);
                        
                        var model = document.createElement('label');
                        model.innerHTML =  msg[i]['model'];
                        divModel.appendChild(model); 
                        
                        var bikePosition = document.createElement('label');
                        bikePosition.innerHTML =  msg[i]['coordinates'];
                        divPosition.appendChild(bikePosition);

                        var bookButton = document.createElement("button");
                        bookButton.classList.add("bookButtonStyle");
                        bookButton.innerHTML = "Book";
                        divButton.appendChild(bookButton);
                        

                        // style arrangement
                        divModel.classList.add("bikeModel");
                        divPosition.classList.add("bikePosition");
                        divName.classList.add("bikeName");
                        divButton.classList.add("bookButton");
                        divPicture.classList.add("bikePicture");
                        
                        // inserting picture
                        divPicture.appendChild(image);
                        

                        // inserting divs in container
                        divContainer.appendChild(divModel);
                        divContainer.appendChild(divPicture);
                        divContainer.appendChild(divButton);
                        divContainer.appendChild(divPosition);
                        divContainer.appendChild(divName);
                        
                        //insert in result table
                        cell.appendChild(divContainer);

                        

                    }
                });

        </script>
    </body>
</html>